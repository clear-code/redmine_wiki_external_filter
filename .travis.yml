notifications:
  webhooks:
    - https://webhook.commit-email.info/

dist: xenial

addons:
  apt:
    package:
      - graphviz
      - plantuml

services:
  - mysql

matrix:
  include:
    - name: "Redmine 3.4"
      env:
        - REDMINE_VERSION=3.4.8

install:
  - cd ..
  - wget http://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz
  - tar xf redmine-${REDMINE_VERSION}.tar.gz
  - ln -s redmine-${REDMINE_VERSION} redmine
  - cd redmine/plugins
  - ln -s ../../redmine_wiki_external_filter wiki_external_filter
  - cd ../
  - cp config/database.yml{.example,}
  - unset BUNDLE_GEMFILE
  - env
  - gem install bundler -v "1.17.3"
  - bundle _1.17.3_ install
  - bin/rake db:create
  - bin/rake generate_secret_token
  - bin/rake db:migrate

test:
  - bin/rake wiki_external_filter:test
